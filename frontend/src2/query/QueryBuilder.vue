<script setup lang="ts">
import { inject, provide } from 'vue'
import QueryBuilderSourceSelector from './components/QueryBuilderSourceSelector.vue'
import QueryBuilderTable from './components/QueryBuilderTable.vue'
import QueryBuilderToolbar from './components/QueryBuilderToolbar.vue'
import QueryOperations from './components/QueryOperations.vue'
import useQuery from './query'
import { WorkbookQuery } from '../workbook/workbook'

const props = defineProps<{ query: WorkbookQuery }>()
const query = useQuery(props.query)
provide('query', query)
</script>

<template>
	<QueryBuilderSourceSelector v-if="!query.doc.operations.length" />
	<div v-else class="relative flex h-full w-full divide-x overflow-hidden p-3">
		<div class="flex h-full w-full flex-col gap-3">
			<QueryBuilderToolbar></QueryBuilderToolbar>
			<QueryBuilderTable></QueryBuilderTable>
		</div>
	</div>
	<div
		class="relative flex h-full w-[17rem] flex-shrink-0 flex-col overflow-y-auto bg-white shadow-sm"
	>
		<QueryOperations />
	</div>
</template>
